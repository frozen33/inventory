{% extends "base.html" %}

{% block title %}Change Password - Inventory Management{% endblock %}

{% block content %}
<div class="card" style="max-width: 400px; margin: 2rem auto;">
    <div class="card-header">
        <h1 class="text-center mt-0 mb-0">üîë Change Password</h1>
    </div>
    <div class="card-body">
        <form method="POST" id="changePasswordForm">
            <div class="form-group">
                <label for="current_password" class="form-label">Current Password</label>
                <input type="password"
                       id="current_password"
                       name="current_password"
                       class="form-input"
                       required
                       placeholder="Enter current password">
            </div>

            <div class="form-group">
                <label for="new_password" class="form-label">New Password</label>
                <input type="password"
                       id="new_password"
                       name="new_password"
                       class="form-input"
                       required
                       placeholder="Enter new password"
                       minlength="6">
                <small style="color: var(--text-secondary); font-size: 0.875rem; margin-top: 0.25rem; display: block;">
                    Minimum 6 characters
                </small>
            </div>

            <div class="form-group">
                <label for="confirm_password" class="form-label">Confirm New Password</label>
                <input type="password"
                       id="confirm_password"
                       name="confirm_password"
                       class="form-input"
                       required
                       placeholder="Confirm new password">
            </div>

            <div class="form-group">
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    üîÑ Change Password
                </button>
            </div>
        </form>
    </div>
    <div class="card-footer text-center">
        <a href="{{ url_for('auth.profile') }}" style="color: var(--primary-color);">‚Üê Back to Profile</a>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('changePasswordForm');
    const newPassword = document.getElementById('new_password');
    const confirmPassword = document.getElementById('confirm_password');

    // Real-time password confirmation validation
    function validatePasswordMatch() {
        if (confirmPassword.value && newPassword.value !== confirmPassword.value) {
            confirmPassword.style.borderColor = 'var(--error-color)';
            return false;
        } else {
            confirmPassword.style.borderColor = 'var(--border-color)';
            return true;
        }
    }

    confirmPassword.addEventListener('input', validatePasswordMatch);
    newPassword.addEventListener('input', function() {
        if (confirmPassword.value) {
            validatePasswordMatch();
        }
    });

    // Form submission validation
    form.addEventListener('submit', function(e) {
        const currentPassword = document.getElementById('current_password').value;
        const newPasswordValue = newPassword.value;
        const confirmPasswordValue = confirmPassword.value;

        if (!currentPassword || !newPasswordValue || !confirmPasswordValue) {
            e.preventDefault();
            alert('Please fill in all fields.');
            return;
        }

        if (newPasswordValue.length < 6) {
            e.preventDefault();
            alert('New password must be at least 6 characters long.');
            return;
        }

        if (newPasswordValue !== confirmPasswordValue) {
            e.preventDefault();
            alert('New passwords do not match.');
            confirmPassword.focus();
            return;
        }

        if (currentPassword === newPasswordValue) {
            e.preventDefault();
            alert('New password must be different from current password.');
            return;
        }
    });
});
</script>
{% endblock %}